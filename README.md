# URIT Export Tools

Инструмент для экспорта результатов анализов из базы данных анализатора URIT в форматы Excel (XLSX) и CSV.

## Описание

Данный набор скриптов позволяет выгружать данные пациентов и результаты исследований за определенную дату. Программа подключается напрямую к MS SQL Server базе данных анализатора, извлекает данные и формирует отчеты.

> **Примечание:** Протестировано с анализатором **URIT 8280**.

**Возможности:**
*   Экспорт данных за текущую или выбранную дату.
*   Сохранение в форматы CSV и Excel (.xlsx).
*   Автоматическое форматирование Excel файлов.
*   Ведение лога операций (`export_log.txt`).

## Структура папок

*   `Запуск_Экспорта.cmd` — Основной файл для запуска программы.
*   `config.json` — Файл конфигурации подключения к базе данных.
*   `app/` — Папка со служебными скриптами и утилитами.
*   `ExportedResults/` — Папка, куда сохраняются готовые отчеты (создается автоматически).
*   `export_log.txt` — Лог-файл выполнения программы.

## Настройка

Перед первым запуском убедитесь, что настройки в файле `config.json` верны. Откройте его любым текстовым редактором (Блокнот, VS Code).

Пример содержимого `config.json`:
```json
{
    "dbHost": ".\\UTSQLSERVER2014",
    "dbName": "DataBaseSQL20230724145927",
    "dbUser": "sa",
    "dbPwd": "111"
}
```

*   **dbHost**: Адрес SQL сервера (обычно `.\UTSQLSERVER2014` для локального сервера URIT).
*   **dbName**: Имя базы данных.
*   **dbUser**: Пользователь SQL (по умолчанию `sa`).
*   **dbPwd**: Пароль пользователя (по умолчанию `111`).

> **Где найти настройки?**
> Актуальные параметры подключения (хост, имя базы, логин) можно посмотреть в файле настроек самого анализатора:
> `..\Setting\DB.INI` (в секции `[MSSQL]`).
> 
> *Обратите внимание:* Пароль в `DB.INI` (параметр `DB_pwd`) хранится в зашифрованном виде (Base64). В `config.json` его нужно указывать в **открытом виде** (например, если в INI написано `MTEx`, то пароль — `111`).

## Использование

1.  Запустите файл **`Запуск_Экспорта.cmd`**.
2.  Откроется окно консоли. Программа предложит ввести дату для экспорта.
    *   Чтобы выгрузить данные за **сегодня**, просто нажмите `Enter`.
    *   Чтобы выгрузить данные за **другую дату**, введите её в формате `ДД-ММ-ГГГГ` (например, `25-01-2024`) и нажмите `Enter`.
3.  Дождитесь завершения процесса. В консоли появится сообщение `Done`.
4.  Нажмите любую клавишу, чтобы закрыть окно.

## Результаты

Готовые файлы находятся в папке `ExportedResults`.
Имена файлов имеют формат: `Export_URIT_YYYY-MM-DD.xlsx` (и `.csv`).

## Возможные ошибки

Если экспорт не удался:
1.  Проверьте файл `export_log.txt` — там описаны детали ошибок.
2.  Убедитесь, что сервер базы данных запущен.
3.  Проверьте правильность имени базы данных, логина и пароля в `config.json`.

## Сторонние компоненты

*   **csv2xlsx** — Утилита для конвертации CSV в Excel.
    *   Автор: mentax
    *   Ссылка: [https://github.com/mentax/csv2xlsx](https://github.com/mentax/csv2xlsx)
